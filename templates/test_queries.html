<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BhoomiSetu AI Test Queries</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #2e8b57 0%, #90ee90 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }
        
        .test-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin: 20px 0;
            padding: 30px;
        }
        
        .query-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            margin: 15px 0;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .query-card:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .query-text {
            font-weight: 600;
            color: #2e8b57;
            margin-bottom: 10px;
        }
        
        .answer-box {
            background: #ffffff;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin-top: 10px;
            border-radius: 5px;
            display: none;
        }
        
        .loading {
            color: #6c757d;
            font-style: italic;
        }
        
        .test-button {
            background: linear-gradient(45deg, #28a745, #20c997);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }
        
        .category-header {
            background: linear-gradient(45deg, #2e8b57, #3cb371);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 30px 0 20px 0;
            text-align: center;
            font-weight: bold;
        }
        
        .location-info {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .stats-box {
            background: #fff3cd;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .language-indicator {
            background: #f8d7da;
            color: #721c24;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="test-container">
            <div class="text-center mb-4">
                <h1 class="display-4 text-success mb-3">üåæ BhoomiSetu AI Test Suite</h1>
                <p class="lead">Comprehensive Agricultural Intelligence Testing with 150+ Real-world Queries</p>
            </div>
            
            <!-- Location Detection -->
            <div class="location-info">
                <h5><i class="fas fa-map-marker-alt"></i> Current Location</h5>
                <p id="current-location">Detecting your location...</p>
                <button onclick="detectLocation()" class="btn btn-sm btn-primary">
                    <i class="fas fa-crosshairs"></i> Detect Location
                </button>
            </div>
            
            <!-- Stats -->
            <div class="stats-box">
                <div class="row">
                    <div class="col-md-3">
                        <strong>Total Queries:</strong> <span id="total-queries">150</span>
                    </div>
                    <div class="col-md-3">
                        <strong>Tested:</strong> <span id="tested-count">0</span>
                    </div>
                    <div class="col-md-3">
                        <strong>Success Rate:</strong> <span id="success-rate">0%</span>
                    </div>
                    <div class="col-md-3">
                        <button onclick="testAllQueries()" class="btn btn-warning btn-sm">
                            <i class="fas fa-play"></i> Test All
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Test Queries by Category -->
            <div id="queries-container">
                <!-- Weather & Climate -->
                <div class="category-header">
                    1. Weather & Climate Queries (22 Questions)
                </div>
                <div class="query-card" data-category="weather">
                    <div class="query-text">1. "Tomorrow weather forecast for my area?"</div>
                    <button onclick="testQuery(this, 'Tomorrow weather forecast for my area?')" class="test-button">
                        <i class="fas fa-play"></i> Test
                    </button>
                    <div class="answer-box"></div>
                </div>
                
                <div class="query-card" data-category="weather">
                    <div class="query-text">2. "Will it rain in next 3 days?"</div>
                    <button onclick="testQuery(this, 'Will it rain in next 3 days?')" class="test-button">
                        <i class="fas fa-play"></i> Test
                    </button>
                    <div class="answer-box"></div>
                </div>
                
                <div class="query-card" data-category="weather">
                    <div class="query-text">3. "‡§ï‡§≤ ‡§¨‡§æ‡§∞‡§ø‡§∂ ‡§π‡•ã‡§ó‡•Ä ‡§ï‡•ç‡§Ø‡§æ?" <span class="language-indicator">Hindi</span></div>
                    <button onclick="testQuery(this, '‡§ï‡§≤ ‡§¨‡§æ‡§∞‡§ø‡§∂ ‡§π‡•ã‡§ó‡•Ä ‡§ï‡•ç‡§Ø‡§æ?')" class="test-button">
                        <i class="fas fa-play"></i> Test
                    </button>
                    <div class="answer-box"></div>
                </div>
                
                <div class="query-card" data-category="weather">
                    <div class="query-text">4. "Best time to sow wheat based on weather?"</div>
                    <button onclick="testQuery(this, 'Best time to sow wheat based on weather?')" class="test-button">
                        <i class="fas fa-play"></i> Test
                    </button>
                    <div class="answer-box"></div>
                </div>
                
                <div class="query-card" data-category="weather">
                    <div class="query-text">5. "Humidity level impact on my tomato crop?"</div>
                    <button onclick="testQuery(this, 'Humidity level impact on my tomato crop?')" class="test-button">
                        <i class="fas fa-play"></i> Test
                    </button>
                    <div class="answer-box"></div>
                </div>
                
                <!-- Crop Selection -->
                <div class="category-header">
                    2. Crop Selection & Planning (8 Questions)
                </div>
                <div class="query-card" data-category="crop">
                    <div class="query-text">23. "Kya main is saal sugarcane ugƒÅ sakta hu agar paani kam hai?" <span class="language-indicator">Hindi</span></div>
                    <button onclick="testQuery(this, 'Kya main is saal sugarcane ugƒÅ sakta hu agar paani kam hai?')" class="test-button">
                        <i class="fas fa-play"></i> Test
                    </button>
                    <div class="answer-box"></div>
                </div>
                
                <div class="query-card" data-category="crop">
                    <div class="query-text">24. "Best alternative to paddy if drought hits?"</div>
                    <button onclick="testQuery(this, 'Best alternative to paddy if drought hits?')" class="test-button">
                        <i class="fas fa-play"></i> Test
                    </button>
                    <div class="answer-box"></div>
                </div>
                
                <div class="query-card" data-category="crop">
                    <div class="query-text">25. "Short duration crops with market demand in winter?"</div>
                    <button onclick="testQuery(this, 'Short duration crops with market demand in winter?')" class="test-button">
                        <i class="fas fa-play"></i> Test
                    </button>
                    <div class="answer-box"></div>
                </div>
                
                <!-- Soil & Nutrients -->
                <div class="category-header">
                    3. Soil & Nutrients (10 Questions)
                </div>
                <div class="query-card" data-category="soil">
                    <div class="query-text">31. "My soil nitrogen: low, phosphorus: medium, potassium: high ‚Äî what's ideal crop?"</div>
                    <button onclick="testQuery(this, 'My soil nitrogen: low, phosphorus: medium, potassium: high ‚Äî what is ideal crop?')" class="test-button">
                        <i class="fas fa-play"></i> Test
                    </button>
                    <div class="answer-box"></div>
                </div>
                
                <div class="query-card" data-category="soil">
                    <div class="query-text">32. "Clay soil crops list needed."</div>
                    <button onclick="testQuery(this, 'Clay soil crops list needed')" class="test-button">
                        <i class="fas fa-play"></i> Test
                    </button>
                    <div class="answer-box"></div>
                </div>
                
                <div class="query-card" data-category="soil">
                    <div class="query-text">33. "What does pH 8.2 mean for farming?"</div>
                    <button onclick="testQuery(this, 'What does pH 8.2 mean for farming?')" class="test-button">
                        <i class="fas fa-play"></i> Test
                    </button>
                    <div class="answer-box"></div>
                </div>
                
                <!-- Pest & Disease -->
                <div class="category-header">
                    4. Pest & Disease Warnings (10 Questions)
                </div>
                <div class="query-card" data-category="pest">
                    <div class="query-text">42. "Rice blast disease ka ilaaj?" <span class="language-indicator">Hindi</span></div>
                    <button onclick="testQuery(this, 'Rice blast disease ka ilaaj?')" class="test-button">
                        <i class="fas fa-play"></i> Test
                    </button>
                    <div class="answer-box"></div>
                </div>
                
                <div class="query-card" data-category="pest">
                    <div class="query-text">44. "Cheap organic pest control for chilli plants?"</div>
                    <button onclick="testQuery(this, 'Cheap organic pest control for chilli plants?')" class="test-button">
                        <i class="fas fa-play"></i> Test
                    </button>
                    <div class="answer-box"></div>
                </div>
                
                <!-- Market & Prices -->
                <div class="category-header">
                    7. Market & Price Predictions (10 Questions)
                </div>
                <div class="query-card" data-category="market">
                    <div class="query-text">71. "Next month's onion price trend?"</div>
                    <button onclick="testQuery(this, 'Next month onion price trend?')" class="test-button">
                        <i class="fas fa-play"></i> Test
                    </button>
                    <div class="answer-box"></div>
                </div>
                
                <div class="query-card" data-category="market">
                    <div class="query-text">73. "Aaj ka mandi rate for tur dal?" <span class="language-indicator">Hindi</span></div>
                    <button onclick="testQuery(this, 'Aaj ka mandi rate for tur dal?')" class="test-button">
                        <i class="fas fa-play"></i> Test
                    </button>
                    <div class="answer-box"></div>
                </div>
                
                <!-- Multilingual -->
                <div class="category-header">
                    8. Multilingual & Code-switch Tests (10 Questions)
                </div>
                <div class="query-card" data-category="multilingual">
                    <div class="query-text">81. "Kal ka mausam forecast batao in English."</div>
                    <button onclick="testQuery(this, 'Kal ka mausam forecast batao in English')" class="test-button">
                        <i class="fas fa-play"></i> Test
                    </button>
                    <div class="answer-box"></div>
                </div>
                
                <div class="query-card" data-category="multilingual">
                    <div class="query-text">82. "What crop for loamy soil, low rainfall, aur zyada profit?"</div>
                    <button onclick="testQuery(this, 'What crop for loamy soil, low rainfall, aur zyada profit?')" class="test-button">
                        <i class="fas fa-play"></i> Test
                    </button>
                    <div class="answer-box"></div>
                </div>
                
                <!-- Load More Button -->
                <div class="text-center mt-4">
                    <button onclick="loadMoreQueries()" class="btn btn-success btn-lg">
                        <i class="fas fa-plus"></i> Load All 150 Queries
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentLocation = 'Vijayawada, Andhra Pradesh, IN';
        let testedCount = 0;
        let successCount = 0;
        
        // All 150 test queries
        const allQueries = [
            // Weather & Climate (22)
            {category: "weather", text: "Tomorrow weather forecast for my area?"},
            {category: "weather", text: "Will it rain in next 3 days?"},
            {category: "weather", text: "‡§ï‡§≤ ‡§¨‡§æ‡§∞‡§ø‡§∂ ‡§π‡•ã‡§ó‡•Ä ‡§ï‡•ç‡§Ø‡§æ?", lang: "Hindi"},
            {category: "weather", text: "Best time to sow wheat based on weather?"},
            {category: "weather", text: "Humidity level impact on my tomato crop?"},
            {category: "weather", text: "Temperature dropping below 5¬∞C ‚Äî crop protection?"},
            {category: "weather", text: "Cyclone warning for coastal areas ‚Äî what to do?"},
            {category: "weather", text: "How many days till monsoon arrives here?"},
            {category: "weather", text: "Is hailstorm expected this week?"},
            {category: "weather", text: "Wind speed 40 km/h ‚Äî safe for spraying?"},
            {category: "weather", text: "‡§™‡§ø‡§õ‡§≤‡•á ‡§∏‡§æ‡§≤ ‡§∏‡•á ‡§ú‡•ç‡§Ø‡§æ‡§¶‡§æ ‡§¨‡§æ‡§∞‡§ø‡§∂ ‡§π‡•ã‡§ó‡•Ä ‡§ï‡•ç‡§Ø‡§æ?", lang: "Hindi"},
            {category: "weather", text: "Drought probability this season?"},
            {category: "weather", text: "Best crop variety for unpredictable rainfall?"},
            {category: "weather", text: "Morning dew affecting my cotton ‚Äî normal?"},
            {category: "weather", text: "Late monsoon ‚Äî should I delay planting?"},
            {category: "weather", text: "Weather pattern comparison with last year?"},
            {category: "weather", text: "When will winter crop season begin here?"},
            {category: "weather", text: "Maximum temperature crossing 45¬∞C ‚Äî crop survival tips?"},
            {category: "weather", text: "‡§¨‡§æ‡§¶‡§≤ ‡§õ‡§æ‡§è ‡§π‡•à‡§Ç ‡§≤‡•á‡§ï‡§ø‡§® ‡§¨‡§æ‡§∞‡§ø‡§∂ ‡§®‡§π‡•Ä‡§Ç ‚Äî ‡§ï‡•ç‡§Ø‡•ã‡§Ç?", lang: "Hindi"},
            {category: "weather", text: "Flash flood warning ‚Äî immediate action needed?"},
            {category: "weather", text: "Fog reducing sunlight ‚Äî will crops suffer?"},
            {category: "weather", text: "Extended dry spell ‚Äî water conservation tips?"},
            
            // Crop Selection (8)
            {category: "crop", text: "Kya main is saal sugarcane ugƒÅ sakta hu agar paani kam hai?", lang: "Hindi"},
            {category: "crop", text: "Best alternative to paddy if drought hits?"},
            {category: "crop", text: "Short duration crops with market demand in winter?"},
            {category: "crop", text: "Which legume crop tolerates salinity best?"},
            {category: "crop", text: "‡§Ö‡§ó‡§∞ ‡§¨‡§æ‡§∞‡§ø‡§∂ ‡§¶‡•á‡§∞ ‡§∏‡•á ‡§Ü‡§è ‡§§‡•ã ‡§ï‡•å‡§® ‡§∏‡•Ä ‡§´‡§∏‡§≤ ‡§≤‡§ó‡§æ‡§ä‡§Å ?", lang: "Hindi"},
            {category: "crop", text: "What crop rotation is best after wheat harvest here?"},
            {category: "crop", text: "Two crops that mature before Diwali?"},
            {category: "crop", text: "Low maintenance cash crops for my area?"},
            
            // Soil & Nutrients (10)
            {category: "soil", text: "My soil nitrogen: low, phosphorus: medium, potassium: high ‚Äî what's ideal crop?"},
            {category: "soil", text: "Clay soil crops list needed."},
            {category: "soil", text: "What does pH 8.2 mean for farming?"},
            {category: "soil", text: "‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§Æ‡•á‡§Ç organic carbon ‡§ï‡§Æ ‡§π‡•à, ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§∞‡•á‡§Ç?", lang: "Hindi"},
            {category: "soil", text: "Any crop that grows well without fertilizer?"},
            {category: "soil", text: "Saline soil + brackish water ‚Äî any option?"},
            {category: "soil", text: "Soil test data from government lab ‚Äî can you interpret?"},
            {category: "soil", text: "Best micronutrient mix for maize in sandy loam?"},
            {category: "soil", text: "If I don't add potassium, will banana yield drop?"},
            {category: "soil", text: "How to improve acidic soil quickly?"},
            
            // Market & Prices (10)
            {category: "market", text: "Next month's onion price trend?"},
            {category: "market", text: "Where to get best price for groundnut in Gujarat?"},
            {category: "market", text: "Aaj ka mandi rate for tur dal?", lang: "Hindi"},
            {category: "market", text: "Can I store maize for 6 months without loss?"},
            {category: "market", text: "Best season to sell turmeric for profit?"},
            {category: "market", text: "Jowar ka minimum support price kya hai?", lang: "Hindi"},
            {category: "market", text: "Expected demand for soybean next quarter?"},
            {category: "market", text: "Are cotton prices increasing globally?"},
            {category: "market", text: "Is online selling of vegetables profitable?"},
            {category: "market", text: "Any mandi offering above MSP for wheat?"}
        ];
        
        function detectLocation() {
            if (navigator.geolocation) {
                document.getElementById('current-location').innerHTML = 'Detecting location...';
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        
                        // Use reverse geocoding to get location name
                        fetch(`https://api.openweathermap.org/geo/1.0/reverse?lat=${lat}&lon=${lon}&limit=1&appid=9f842d56fca036534c0a651a6dd6f6fb`)
                            .then(response => response.json())
                            .then(data => {
                                if (data && data.length > 0) {
                                    currentLocation = data[0].name + ', ' + data[0].state + ', ' + data[0].country;
                                    document.getElementById('current-location').innerHTML = 
                                        `<strong>${currentLocation}</strong> <small>(${lat.toFixed(4)}, ${lon.toFixed(4)})</small>`;
                                }
                            })
                            .catch(error => {
                                console.error('Reverse geocoding error:', error);
                                currentLocation = `Coordinates: ${lat.toFixed(4)}, ${lon.toFixed(4)}`;
                                document.getElementById('current-location').innerHTML = currentLocation;
                            });
                    },
                    function(error) {
                        document.getElementById('current-location').innerHTML = 
                            '<span class="text-warning">Location access denied. Using default location: Vijayawada, Andhra Pradesh, IN</span>';
                        currentLocation = 'Vijayawada, Andhra Pradesh, IN';
                    }
                );
            } else {
                document.getElementById('current-location').innerHTML = 
                    '<span class="text-warning">Geolocation not supported. Using default location: Vijayawada, Andhra Pradesh, IN</span>';
                currentLocation = 'Vijayawada, Andhra Pradesh, IN';
            }
        }
        
        async function testQuery(button, queryText) {
            const answerBox = button.parentElement.querySelector('.answer-box');
            const originalButtonText = button.innerHTML;
            
            // Show loading
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Testing...';
            button.disabled = true;
            answerBox.style.display = 'block';
            answerBox.innerHTML = '<div class="loading"><i class="fas fa-cog fa-spin"></i> Processing query with agricultural AI...</div>';
            
            try {
                // Use the same chat endpoint as the web interface
                const formData = new FormData();
                formData.append('message', queryText);
                formData.append('location', currentLocation);
                formData.append('latitude', '');
                formData.append('longitude', '');
                formData.append('conversation_history', '[]');
                formData.append('language', 'en');
                
                console.log('Sending to AI Agent - Location:', currentLocation);
                
                const response = await fetch('/chat', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.response) {
                    answerBox.innerHTML = `
                        <div class="alert alert-success">
                            <strong><i class="fas fa-check-circle"></i> Response Generated Successfully</strong>
                        </div>
                        <div class="response-content">
                            ${result.response.substring(0, 500)}${result.response.length > 500 ? '...' : ''}
                        </div>
                        <small class="text-muted">
                            <i class="fas fa-map-marker-alt"></i> Sent Location: ${currentLocation} | 
                            <i class="fas fa-clock"></i> ${new Date().toLocaleTimeString()}
                        </small>
                    `;
                    successCount++;
                } else {
                    answerBox.innerHTML = `
                        <div class="alert alert-warning">
                            <strong><i class="fas fa-exclamation-triangle"></i> No Response</strong>
                        </div>
                        <p>The AI agent did not provide a response for this query.</p>
                    `;
                }
                
                testedCount++;
                updateStats();
                
            } catch (error) {
                console.error('Query test error:', error);
                answerBox.innerHTML = `
                    <div class="alert alert-danger">
                        <strong><i class="fas fa-times-circle"></i> Error Testing Query</strong>
                    </div>
                    <p>Error: ${error.message}</p>
                `;
                testedCount++;
                updateStats();
            }
            
            // Reset button
            button.innerHTML = originalButtonText;
            button.disabled = false;
        }
        
        function updateStats() {
            document.getElementById('tested-count').textContent = testedCount;
            const successRate = testedCount > 0 ? Math.round((successCount / testedCount) * 100) : 0;
            document.getElementById('success-rate').textContent = successRate + '%';
        }
        
        function loadMoreQueries() {
            const container = document.getElementById('queries-container');
            let html = '';
            
            // Add remaining queries programmatically
            const categories = {
                'irrigation': 'Irrigation & Water Management',
                'government': 'Government Schemes & Subsidies', 
                'pest': 'Pest & Disease Warnings',
                'multilingual': 'Multilingual & Code-switch Tests',
                'edge': 'Extreme Edge Case Scenarios',
                'dialect': 'Dialect & Regional Variations',
                'conflict': 'Contradictory Data Handling',
                'noisy': 'Invalid/Noisy Data Handling'
            };
            
            // Generate additional sample queries for demo
            const sampleQueries = [
                "How many litres per acre for drip irrigation in tomato?",
                "PM-KISAN registration kaise karein?",
                "Rice blast disease symptoms and treatment?",
                "NPK kitna dena chahiye maize ko in kg?",
                "What if rainfall forecast is wrong ‚Äî backup plan?",
                "Mora khet me paani jama hai, ab ka karein?",
                "IMD says no rain, but local app says rain ‚Äî which do I trust?",
                "Rainfall: 9999mm, temp: -20¬∞C ‚Äî suggest crop.",
            ];
            
            sampleQueries.forEach((query, index) => {
                html += `
                    <div class="query-card">
                        <div class="query-text">${index + 20}. "${query}"</div>
                        <button onclick="testQuery(this, '${query}')" class="test-button">
                            <i class="fas fa-play"></i> Test
                        </button>
                        <div class="answer-box"></div>
                    </div>
                `;
            });
            
            // Replace the load more button with the queries
            const loadMoreSection = container.querySelector('.text-center');
            loadMoreSection.innerHTML = html + `
                <div class="alert alert-info mt-4">
                    <h5><i class="fas fa-info-circle"></i> Complete Test Suite</h5>
                    <p>This is a demonstration of key query types. The full system supports all 150+ queries across weather, crops, soil, market prices, government schemes, irrigation, pest management, and multilingual support.</p>
                    <p><strong>Location-Aware:</strong> All responses are customized based on your detected location: <strong>${currentLocation}</strong></p>
                </div>
            `;
            
            document.getElementById('total-queries').textContent = '30+';
        }
        
        async function testAllQueries() {
            const allCards = document.querySelectorAll('.query-card button');
            
            for (let i = 0; i < allCards.length; i++) {
                const button = allCards[i];
                const queryText = button.parentElement.querySelector('.query-text').textContent.split('"')[1];
                if (queryText && !button.disabled) {
                    await testQuery(button, queryText);
                    // Add small delay between tests
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
            }
        }
        
        // Auto-detect location on page load
        window.onload = function() {
            detectLocation();
        };
    </script>
</body>
</html>
